var ABTest=function(t,a){this.$this=t,this.selectedText=t.get(0),this.data={},this.data.css={},this.data.setUser=a};ABTest.prototype.wrapContent=function(){try{if(window.ActiveXObject){var t=document.selection.createRange();return t.htmlText}var a=document.createElement("span");a.className="edited bg",a.setAttribute("data-id",window.abt_varCount);var e=window.getSelection().getRangeAt(0);return e.surroundContents(a),a.innerHTML}catch(n){return window.ActiveXObject?document.selection.createRange():window.getSelection()}},ABTest.prototype.create_toolbox=function(t){"undefined"==typeof t&&(t="short");var a="",e="",n=[["he",{classA:"h",classI:"lifebuoy"}],["te",{classA:"b",classI:"bold"},{classA:"u",classI:"underline"},{classA:"i",classI:"italic"},{classA:"a",classI:"font"}],["al",{classA:"j",classI:"align-justify"},{classA:"l",classI:"align-left"},{classA:"c",classI:"align-center"},{classA:"r",classI:"align-right"}],["li",{classA:"it",classI:"text-width"},{classA:"il",classI:"text-height"}],["",{classA:"del",classI:"trash"},{classA:"cl",classI:"cancel"},{classA:"sv",classI:"floppy"}]];return a="extended"===t?'<ul class="abt-toolbox extended" data-id="-1">':'<ul class="abt-toolbox">',$.each(n,function(t,n){$.each(n,function(t,n){"string"==typeof n||n instanceof String?(e=n,a+="li"===n?'<li class="abt-'+e+'" data-id="-1">':'<li data-id="-1">'):a+='<a href="#" class="abt-'+e+" abt-"+n.classA+'" data-id="-1"><i class="icon-'+n.classI+'" data-id="-1"></i></a>'}),a+="</li>"}),a+="</ul>"},ABTest.prototype.changeStyle=function(i){eval("this.data"+i+"=!this.data"+i+";");var rtrn=new Object;switch(i){case"b":rtrn.prop="font-weight",rtrn.val="bold",rtrn.css="fontWeight";break;case"u":rtrn.prop="text-decoration",rtrn.val="underline",rtrn.css="textDecoration";break;case"i":rtrn.prop="font-style",rtrn.val="italic",rtrn.css="fontStyle";break;case"j":rtrn.prop="text-align",rtrn.val="justify",rtrn.css="textAlign";break;case"r":rtrn.prop="text-align",rtrn.val="right",rtrn.css="textAlign";break;case"c":rtrn.prop="text-align",rtrn.val="center",rtrn.css="textAlign";break;case"l":rtrn.prop="text-align",rtrn.val="left",rtrn.css="textAlign"}eval("this.data"+i+";")?("textAlign"===rtrn.css?$("[data-id="+window.abt_lastVar[0]+"]").parent().css(rtrn.prop,rtrn.val):$("[data-id="+window.abt_lastVar[0]+"]").css(rtrn.prop,rtrn.val),this.data.css[rtrn.css]=rtrn.val):($("[data-id="+window.abt_lastVar[0]+"]").removeStyle(rtrn.prop),delete this.data.css[rtrn.css]),$(this).toggleClass("selected")},ABTest.prototype.toolboxOptions=function(){var t=this.data.css;for(var a in t)"fontWeight"===a&&"bold"===t[a]&&$(".abt-b").addClass("selected"),"textDecoration"===a&&"underline"===t[a]&&$(".abt-u").addClass("selected"),"fontStyle"===a&&"italic"===t[a]&&$(".abt-i").addClass("selected"),"textAlign"===a&&"justify"===t[a]&&$(".abt-j").addClass("selected"),"textAlign"===a&&"right"===t[a]&&$(".abt-r").addClass("selected"),"textAlign"===a&&"center"===t[a]&&$(".abt-c").addClass("selected"),"textAlign"===a&&"left"===t[a]&&$(".abt-l").addClass("selected")},ABTest.prototype.add_toolbox=function(){$(".abt-toolbox").remove(),$("[data-id="+window.abt_lastVar[0]+"]").addClass("bg")},ABTest.prototype.button_action=function(t){var a=t.attr("class").split(" "),e=a[1].split("-");"j"!==e[1]&&"l"!==e[1]&&"c"!==e[1]&&"r"!==e[1]||$(".abt-al").removeClass("selected"),$(".abt-"+e[1]).toggleClass("selected"),window.abt_var[window.abt_lastVar[0]].changeStyle(e[1])},$.fn.makeItEditable=function(){$(this).attr({contenteditable:"true","class":"editable"})},$.fn.removeStyle=function(t){var a=new RegExp(t+"[^;]+;?","g");return this.each(function(){$(this).attr("style",function(t,e){return e.replace(a,"")})})},$.fn.get_id=function(t){for(var a=!1,e="",n=0;n<t.rangeCount;n++){var s=$(t.getRangeAt(n).startContainer.parentNode);return s.attr("data-id")}};var cssId="_abt";if(!document.getElementById(cssId)){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.id=cssId,link.rel="stylesheet",link.type="text/css",link.media="all",link.href="assets/css/abt.min.css",head.appendChild(link)}window.abt_var=new Array,window.abt_varCount=0,window.abt_lastVar=[0,0],$("p").mouseup(function(t){t.stopPropagation();var a=window.getSelection(),e=a.isCollapsed,n=a.getRangeAt(0),s="edited"===n.startContainer.parentNode.getAttribute("class"),r=!$(this).attr("contenteditable"),o=$(this).get_id(a);o?o>-1&&(window.abt_lastVar.pop(),window.abt_lastVar.unshift(parseInt(o))):(window.abt_lastVar.unshift(window.abt_varCount),window.abt_lastVar.pop(),abt=new ABTest($(this),_abt.setUser),window.abt_var[window.abt_lastVar[0]]=abt,window.abt_var[window.abt_lastVar[0]].wrapContent(),abt_varCount++),r&&$(this).makeItEditable(),e?s&&(window.abt_var[window.abt_lastVar[0]].add_toolbox("extended"),$(window.abt_var[window.abt_lastVar[0]].selectedText).append(window.abt_var[window.abt_lastVar[0]].create_toolbox("extended")),window.abt_var[window.abt_lastVar[0]].toolboxOptions(n)):e||($(".edited").removeClass("bg"),s?(window.abt_var[window.abt_lastVar[0]].add_toolbox("extended"),$(window.abt_var[window.abt_lastVar[0]].selectedText).append(window.abt_var[window.abt_lastVar[0]].create_toolbox("extended"))):(window.abt_var[window.abt_lastVar[0]].add_toolbox("extended"),$(window.abt_var[window.abt_lastVar[0]].selectedText).append(window.abt_var[window.abt_lastVar[0]].create_toolbox("extended"))))}),$("body").on("click",".abt-te",function(t){t.preventDefault(),t.stopPropagation(),window.abt_var[window.abt_lastVar[0]].button_action($(this))}),$("body").on("click",".abt-al",function(t){t.preventDefault(),t.stopPropagation(),window.abt_var[window.abt_lastVar[0]].button_action($(this))}),$("body").on("click",".abt-del",function(t){t.preventDefault(),t.stopPropagation(),$(this).parent().parent().css("text-align",""),$("*[data-id="+window.abt_lastVar[0]+"]").contents().unwrap(),$(".abt-toolbox").remove(),window.abt_var[window.abt_lastVar[0]]=null,delete window.abt_var[window.abt_lastVar[0]]}),$("body").on("click",".abt-cl",function(t){t.preventDefault(),t.stopPropagation(),$(".abt-toolbox").remove(),$("[data-id="+window.abt_lastVar[0]+"].bg").removeClass("bg")}),$("body").on("click",".abt-h",function(t){t.preventDefault()}),$("body").on("click",".abt-sv",function(t){t.preventDefault(),e.stopPropagation(),$.ajax({type:"POST",url:"http://rPi3.local/",data:myVar.data,success:success,dataType:dataType})});