var ABTest=function(t,e){this.$this=t,this.selectedText=t.get(0),this.data={},this.data.css={},this.data.setUser=e};ABTest.prototype.wrapContent=function(){try{if(window.ActiveXObject){var t=document.selection.createRange();return t.htmlText}var e=document.createElement("span");e.className="edited bg",e.setAttribute("data-id",window.gVarCount);var a=window.getSelection().getRangeAt(0);return a.surroundContents(e),e.innerHTML}catch(n){return window.ActiveXObject?document.selection.createRange():window.getSelection()}},ABTest.prototype.create_toolbox=function(t){"undefined"==typeof t&&(t="short");var e="",a="",n=[["he",{classA:"h",classI:"lifebuoy"}],["te",{classA:"b",classI:"bold"},{classA:"u",classI:"underline"},{classA:"i",classI:"italic"},{classA:"a",classI:"font"}],["al",{classA:"j",classI:"align-justify"},{classA:"l",classI:"align-left"},{classA:"c",classI:"align-center"},{classA:"r",classI:"align-right"}],["li",{classA:"it",classI:"text-width"},{classA:"il",classI:"text-height"}],["",{classA:"del",classI:"trash"},{classA:"cl",classI:"cancel"},{classA:"sv",classI:"floppy"}]];return e="extended"===t?'<ul class="abt-toolbox extended">':'<ul class="abt-toolbox">',$.each(n,function(t,n){$.each(n,function(t,n){"string"==typeof n||n instanceof String?(a=n,e+="li"===n?'<li class="abt-'+a+'">':"<li>"):e+='<a href="#" class="abt-'+a+" abt-"+n.classA+'"><i class="icon-'+n.classI+'"></i></a>'}),e+="</li>"}),e+="</ul>"},ABTest.prototype.changeStyle=function(i){eval("this.data"+i+"=!this.data"+i+";");var rtrn=new Object;switch(i){case"b":rtrn.prop="font-weight",rtrn.val="bold",rtrn.css="fontWeight";break;case"u":rtrn.prop="text-decoration",rtrn.val="underline",rtrn.css="textDecoration";break;case"i":rtrn.prop="font-style",rtrn.val="italic",rtrn.css="fontStyle";break;case"j":rtrn.prop="text-align",rtrn.val="justify",rtrn.css="textAlign";break;case"r":rtrn.prop="text-align",rtrn.val="right",rtrn.css="textAlign";break;case"c":rtrn.prop="text-align",rtrn.val="center",rtrn.css="textAlign";break;case"l":rtrn.prop="text-align",rtrn.val="left",rtrn.css="textAlign"}eval("this.data"+i+";")?("textAlign"===rtrn.css?$(".edited").parent().css(rtrn.prop,rtrn.val):$(".edited").css(rtrn.prop,rtrn.val),this.data.css[rtrn.css]=rtrn.val):($(".edited").removeStyle(rtrn.prop),delete this.data.css[rtrn.css]),$(this).toggleClass("selected")},ABTest.prototype.toolboxOptions=function(){var t=this.data.css;for(var e in t)"fontWeight"===e&&"bold"===t[e]&&$(".abt-b").addClass("selected"),"textDecoration"===e&&"underline"===t[e]&&$(".abt-u").addClass("selected"),"fontStyle"===e&&"italic"===t[e]&&$(".abt-i").addClass("selected"),"textAlign"===e&&"justify"===t[e]&&$(".abt-j").addClass("selected"),"textAlign"===e&&"right"===t[e]&&$(".abt-r").addClass("selected"),"textAlign"===e&&"center"===t[e]&&$(".abt-c").addClass("selected"),"textAlign"===e&&"left"===t[e]&&$(".abt-l").addClass("selected")},ABTest.prototype.add_toolbox=function(){$(".abt-toolbox").remove(),$(".edited").addClass("bg")},ABTest.prototype.button_action=function(t){var e=t.attr("class").split(" "),a=e[1].split("-");"j"!==a[1]&&"l"!==a[1]&&"c"!==a[1]&&"r"!==a[1]||$(".abt-al").removeClass("selected"),$(".abt-"+a[1]).toggleClass("selected"),window.gVar[window.num].changeStyle(a[1])},$.fn.makeItEditable=function(){$(this).attr({contenteditable:"true","class":"editable"})},$.fn.removeStyle=function(t){var e=new RegExp(t+"[^;]+;?","g");return this.each(function(){$(this).attr("style",function(t,a){return a.replace(e,"")})})},$.fn.get_id=function(t){for(var e=!1,a="",n=0;n<t.rangeCount;n++){var s=$(t.getRangeAt(n).startContainer.parentNode);return s.attr("data-id")}};var cssId="_abt";if(!document.getElementById(cssId)){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.id=cssId,link.rel="stylesheet",link.type="text/css",link.media="all",link.href="assets/css/abt.min.css",head.appendChild(link)}window.gVarCount=0,window.gVar=new Array,window.num=0,$("*:not(.abt-toolbox *)",document.body).mouseup(function(t){t.stopPropagation();var e=window.getSelection(),a=e.isCollapsed,n=e.getRangeAt(0),s="edited"===n.startContainer.parentNode.getAttribute("class"),o=!$(this).attr("contenteditable"),r=$(this).get_id(e);r?num=r:(num=gVarCount,abt=new ABTest($(this),_abt.setUser),window.gVar[num]=abt,window.gVar[num].wrapContent(),gVarCount++),o&&$(this).makeItEditable(),a?s&&(window.gVar[num].add_toolbox("extended"),$(window.gVar[num].selectedText).append(window.gVar[num].create_toolbox("extended")),window.gVar[num].toolboxOptions(n)):a||(s?(window.gVar[num].add_toolbox("extended"),$(window.gVar[num].selectedText).append(window.gVar[num].create_toolbox("extended"))):(window.gVar[num].add_toolbox("extended"),$(window.gVar[num].selectedText).append(window.gVar[num].create_toolbox("extended"))))}),$("body").on("click",".abt-te",function(t){t.preventDefault(),t.stopPropagation(),window.gVar[num].button_action($(this))}),$("body").on("click",".abt-al",function(t){t.preventDefault(),window.gVar[num].button_action($(this))}),$("body").on("click",".abt-del",function(t){t.preventDefault(),t.stopPropagation(),$(this).parent().parent().css("text-align",""),$(".edited").contents().unwrap(),$(".abt-toolbox").remove(),window.gVar[num]=null,delete window.gVar[num]}),$("body").on("click",".abt-cl",function(t){t.preventDefault(),t.stopPropagation(),$(".abt-toolbox").remove(),$(".edited.bg").removeClass("bg")}),$("body").on("click",".abt-h",function(t){t.preventDefault()}),$("body").on("click",".abt-sv",function(t){t.preventDefault(),e.stopPropagation(),$.ajax({type:"POST",url:"http://rPi3.local/",data:myVar.data,success:success,dataType:dataType})});