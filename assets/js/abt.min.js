var ABTest=function(t,e){this._this=t,this.selectedText=t.get(0),this.data={},this.data.css={},this.data.setUser=e};ABTest.prototype.wrapContent=function(){try{if(window.ActiveXObject){var t=document.selection.createRange();return t.htmlText}var e=document.createElement("span");e.className="edited bg";var a=window.getSelection().getRangeAt(0);return a.surroundContents(e),e.innerHTML}catch(n){return window.ActiveXObject?document.selection.createRange():window.getSelection()}},ABTest.prototype.create_toolbox=function(t){"undefined"==typeof t&&(t="short");var e="";return e="extended"===t?'<ul class="abt-toolbox extended">':'<ul class="abt-toolbox">',e+='<li><a href="#" class="abt-he abt-h" target="_blank"><i class="icon-lifebuoy"></i></a></li>',e+="<li>",e+='<a href="#" class="abt-te abt-b"><i class="icon-bold"></i></a>',e+='<a href="#" class="abt-te abt-u"><i class="icon-underline"></i></a>',e+='<a href="#" class="abt-te abt-i"><i class="icon-italic"></i></a>',e+='<a href="#" class="abt-te abt-a"><i class="icon-font"></i></a>',e+="</li>",e+="<li>",e+='<a href="#" class="abt-al abt-j"><i class="icon-align-justify"></i></a>',e+='<a href="#" class="abt-al abt-l"><i class="icon-align-left"></i></a>',e+='<a href="#" class="abt-al abt-c"><i class="icon-align-center"></i></a>',e+='<a href="#" class="abt-al abt-r"><i class="icon-align-right"></i></a>',e+="</li>",e+='<li class="abt-li">',e+='<a href="#" class="abt-li abt-it"><i class="icon-text-width"></i></a>',e+='<a href="#" class="abt-li abt-il"><i class="icon-text-height"></i></a>',e+="</li>",e+="<li>",e+='<a href="#" class="abt-del"><i class="icon-trash"></i></a>',e+='<a href="#" class="abt-cl"><i class="icon-cancel"></i></a>',e+='<a href="#" class="abt-sv"><i class="icon-floppy"></i></a>',e+="</li>",e+="</ul>"},ABTest.prototype.changeStyle=function(i){eval("this.data"+i+"=!this.data"+i+";");var rtrn={};switch(i){case"b":rtrn.prop="font-weight",rtrn.val="bold",rtrn.css="fontWeight";break;case"u":rtrn.prop="text-decoration",rtrn.val="underline",rtrn.css="textDecoration";break;case"i":rtrn.prop="font-style",rtrn.val="italic",rtrn.css="fontStyle";break;case"j":rtrn.prop="text-align",rtrn.val="justify",rtrn.css="textAlign";break;case"r":rtrn.prop="text-align",rtrn.val="right",rtrn.css="textAlign";break;case"c":rtrn.prop="text-align",rtrn.val="center",rtrn.css="textAlign";break;case"l":rtrn.prop="text-align",rtrn.val="left",rtrn.css="textAlign"}eval("this.data"+i+";")?("textAlign"===rtrn.css?$(".edited").parent().css(rtrn.prop,rtrn.val):$(".edited").css(rtrn.prop,rtrn.val),this.data.css[rtrn.css]=rtrn.val):($(".edited").removeStyle(rtrn.prop),delete this.data.css[rtrn.css]),$(this).toggleClass("selected")},ABTest.prototype.toolboxOptions=function(){var t=this.data.css;for(var e in t)"fontWeight"===e&&"bold"===t[e]&&$(".abt-b").addClass("selected"),"textDecoration"===e&&"underline"===t[e]&&$(".abt-u").addClass("selected"),"fontStyle"===e&&"italic"===t[e]&&$(".abt-i").addClass("selected"),"textAlign"===e&&"justify"===t[e]&&$(".abt-j").addClass("selected"),"textAlign"===e&&"right"===t[e]&&$(".abt-r").addClass("selected"),"textAlign"===e&&"center"===t[e]&&$(".abt-c").addClass("selected"),"textAlign"===e&&"left"===t[e]&&$(".abt-l").addClass("selected")},ABTest.prototype.add_toolbox=function(){$(".abt-toolbox").remove(),$(".edited").addClass("bg")},$.fn.makeItEditable=function(){$(this).attr({contenteditable:"true","class":"editable"})},$.fn.removeStyle=function(t){var e=new RegExp(t+"[^;]+;?","g");return this.each(function(){$(this).attr("style",function(t,a){return a.replace(e,"")})})};var cssId="_abt";if(!document.getElementById(cssId)){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.id=cssId,link.rel="stylesheet",link.type="text/css",link.href="http://rPi3.local/abt.min.css",link.media="all",head.appendChild(link)}$("*",document.body).mouseup(function(t){t.stopPropagation();var e=window.getSelection(),a=e.isCollapsed,n=e.getRangeAt(0),s="edited"===n.startContainer.parentNode.getAttribute("class"),i=!$(this).attr("contenteditable");window.myVar||(window.myVar=new ABTest($(this),_abt.setUser),window.myVar.wrapContent()),i&&$(this).makeItEditable(),a?s&&(window.myVar.add_toolbox("extended"),$(window.myVar.selectedText).append(window.myVar.create_toolbox("extended")),window.myVar.toolboxOptions(n)):a||(s?(window.myVar.add_toolbox("extended"),$(window.myVar.selectedText).append(window.myVar.create_toolbox("extended"))):(window.myVar.add_toolbox("extended"),$(window.myVar.selectedText).append(window.myVar.create_toolbox("extended"))))}),$("body").on("click",".abt-te",function(t){t.preventDefault();var e=$(this).attr("class").split(" "),a=e[1].split("-");$(".abt-"+a[1]).toggleClass("selected"),window.myVar.changeStyle(a[1])}),$("body").on("click",".abt-al",function(t){t.preventDefault();var e=$(this).attr("class").split(" "),a=e[1].split("-");$(".abt-al").removeClass("selected"),$(".abt-"+a[1]).toggleClass("selected"),window.myVar.changeStyle(a[1])}),$("body").on("click",".abt-del",function(t){t.preventDefault(),$(this).parent().parent().css("text-align",""),$(".edited").contents().unwrap(),$(".abt-toolbox").remove(),window.myVar=null,delete window.myVar}),$("body").on("click",".abt-cl",function(t){t.preventDefault(),$(".abt-toolbox").remove(),$(".edited.bg").removeClass("bg")}),$("body").on("click",".abt-h",function(t){t.preventDefault()});